!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){e.fn.isendMsg=function(t){t.phoneId||console.error("手机号码文本框ID未设置"),t=e.extend(!0,{timeOut:60,countText:"{n}S",sign:"",sendDatas:{},captcha:!1,captchaUrl:"",errorCount:0},t);var n=e(this),c=this,a=t.timeOut,i=e("#"+t.phoneId);c.validPhoneFild=function(){var e=i.val();return!!e&&!!/^0?1[3|4|5|7|8][0-9]\d{8}$/.test(e)},c.init=function(){n.attr("disabled",!0),c.start()},c.start=function(){var e=t.countText;a>0?(e=e.replace(/{n}/i,a--),n.text(e),setTimeout(function(){c.start()},1e3)):(n.removeAttr("disabled").text("再次发送"),a=t.timeout)},c.sendAjax=function(a){e.ajax({url:t.url,dataType:"json",type:"post",data:a,beforeSend:function(){var e=!0;return t.beforeSend&&"function"==typeof t.beforeSend&&(e=t.beforeSend()),e},success:function(e){if(0!=e.error_code)return n.removeAttr("disabled"),t.error&&"function"==typeof t.error&&t.error(e),!1;c.init(),t.success&&"function"==typeof t.success&&t.success(e)},error:function(){n.removeAttr("disabled")}})},c.captchaModelOpen=function(t,n){var a="CAPTCHMODEL",i=e("#"+a);if(0==i.size()){var o=["取消","确定"],r=Math.random(),d='<div id="'+a+'">';d+='<div class="captcha-model">',d+='<div class="captcha-model-title">请输入图形验证码</div>',d+='<div class="captcha-model-content">',d+='<div class="captcha-inputWapper"><input id="CAPTCHINPUT" placeholder="请输入图形验证码" />',d+='<img id="captchaImage" src="'+t+'" onClick="this.src=\''+t+"?version="+r+"'\" /></div>",d+="</div>",d+='<div class="captcha-model-buttons">',d+='<span class="captcha-model-button" id="captchaCancel">'+o[0]+"</span>",d+='<span class="captcha-model-button" id="captchaOk">'+o[1]+"</span>",d+="</div>",d+="</div>",e("body").append(d),c.captchaModelAnimation(a),e("#captchaCancel").click(function(){c.captchaModelClose(a)}),e("#captchaOk").click(function(){var t=e("#CAPTCHINPUT").val();t?(n(t),c.captchaModelClose(a)):e("#CAPTCHINPUT").focus()})}else i.fadeIn(function(){e("#CAPTCHINPUT").val(""),c.captchaChange()})},c.captchaModelClose=function(t){e("#"+t).fadeOut()},c.captchaModelAnimation=function(t){e("#"+t).fadeIn()},c.captchaChange=function(){e("#captchaImage").trigger("click")},c.encryptRuleQuery=function(e){if(t.encryptRule&&"function"==typeof t.encryptRule)return t.encryptRule(e)},n.on("click",function(){if(0==c.validPhoneFild())return alert("请输入正确的手机号码，再点击发送"),i.focus().select(),!1;var n={};n.phone=i.val(),t.sign&&(n.sign=t.sign),n=e.extend(!0,t.sendDatas,n),t.captcha?c.captchaModelOpen(t.captchaUrl,function(e){n.verfiy=e,n=c.encryptRuleQuery(n),c.sendAjax(n)}):(n=c.encryptRuleQuery(n),c.sendAjax(n))})}});